name: CI

on:
  push:
    branches: [ release ]  # –¢—Ä–∏–≥–≥–µ—Ä –Ω–∞ –ø—É—à–∏ –≤ –≤–µ—Ç–∫—É release
  pull_request:
    branches: [ release ]  # –¢—Ä–∏–≥–≥–µ—Ä –Ω–∞ PR –≤ –≤–µ—Ç–∫—É release

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    # üîë –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ú–û–ú–ï–ù–¢: –¥–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ permissions
    permissions:
      contents: write  # –î–∞–µ—Ç –ø—Ä–∞–≤–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ –≤–µ—Ç–∫—É gh-pages
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        ref: release

    # 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    # 3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Sphinx –∏ —Ç–µ–º–∞)
    - name: Install dependencies
      run: |
        pip install sphinx sphinx-rtd-theme

    # 4. –°–æ–±–∏—Ä–∞–µ–º HTML-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
    - name: Build documentation
      run: |
         sphinx-build -b html docs/source/ docs/build/

    # 5. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ GitHub Pages
    - name: Deploy to GitHub Pages
      if: github.event_name == 'push' && github.ref == 'refs/heads/release'  # –î–µ–ø–ª–æ–∏–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä—è–º–æ–º –ø—É—à–µ –≤ release
      uses: peaceiris/actions-gh-pages@v4
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: docs/build  # –ü–∞–ø–∫–∞ —Å —Å–æ–±—Ä–∞–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
        publish_branch: gh-pages  # –í–µ—Ç–∫–∞, –∫—É–¥–∞ –±—É–¥–µ—Ç –∑–∞–ª–∏–≤–∞—Ç—å—Å—è —Å–∞–π—Ç
